<form id="product-form-{{ section.id }}">
  <input type="hidden" id="main-product-id" value="{{ product.selected_or_first_available_variant.id }}">

  <!-- Nom -->
  <div class="custom-field">
    <label for="nom">Nom (+2 €)</label>
    <input type="text" id="nom" placeholder="Entrer le nom">
  </div>

  <!-- Numéro -->
  <div class="custom-field">
    <label for="numero">Numéro (+2 €)</label>
    <input type="number" id="numero" placeholder="Entrer le numéro" min="0">
  </div>

  <!-- Version -->
  <div class="custom-field">
    <label>Version</label>
    <div class="radio-group">
      <label><input type="radio" name="version" value="Fan"> Fan</label>
      <label><input type="radio" name="version" value="Player"> Player (+8€)</label>
    </div>
  </div>

  <!-- Quantity -->
  <div class="custom-quantity">
    <label for="Quantity">Quantité</label>
    <div class="quantity-wrapper">
      <button type="button" class="qty-btn" id="decrease">−</button>
      <input type="number" id="Quantity" value="1" min="1">
      <button type="button" class="qty-btn" id="increase">+</button>
    </div>
  </div>

  <button type="submit" class="btn-add-to-cart">Ajouter au panier</button>
</form>

<style>
  /* Quantity styling */
.custom-quantity {
  margin-bottom: 20px;
}
.quantity-wrapper {
  display: flex;
  align-items: center;
  border: 1px solid #000;
  border-radius: 6px;
  width: 120px;
  overflow: hidden;
  background: #FFF; /* Added white background */
}
.quantity-wrapper input {
  width: 50px;
  text-align: center;
  border: none;
  outline: none;
  font-size: 16px;
  background: #FFF; /* Force white background */
  -moz-appearance: textfield; /* Remove Firefox arrows */
}

/* Remove spinner buttons in Webkit browsers */
.quantity-wrapper input::-webkit-outer-spin-button,
.quantity-wrapper input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
  background: #FFF; /* Ensure white background */
}

.qty-btn {
  background: #FFF;
  border: none;
  padding: 0 12px;
  font-size: 20px;
  cursor: pointer;
  transition: background 0.2s;
  height: 40px; /* set same height as input */
}

.qty-btn:hover {
  background: #e0e0e0;
}
/* General input style */
.custom-field {
  margin-bottom: 15px;
}
.custom-field label {
  display: block;
  font-weight: 500;
  margin-bottom: 5px;
}
.custom-field input[type="text"],
.custom-field input[type="number"] {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #FFF;
  border-radius: 6px;
  font-size: 14px;
}

/* Radio group */
.radio-group label {
  margin-right: 15px;
  font-weight: normal;
}
.quantity-wrapper {
  display: flex;
  align-items: center;
  border: 1px solid #000;
  border-radius: 6px;
  width: 120px;
  overflow: hidden;
}
.quantity-wrapper input {
  width: 50px;
  text-align: center;
  border: none;
  outline: none;
  font-size: 16px;
}
.qty-container {
  display: inline-flex;
  align-items: center;
  border: 1px solid #000; /* black border around the whole box */
  border-radius: 6px;
  overflow: hidden;
  width: fit-content;
}

.qty-btn {
  background: #FFF;
  border: none;
  padding: 0 12px;
  font-size: 20px;
  cursor: pointer;
  transition: background 0.2s;
  height: 40px; /* set same height as input */
}

.qty-btn:hover {
  background: #e0e0e0;
}

.qty-input {
  width: 40px;
  height: 40px;
  text-align: center;
  border: none;
  font-size: 16px;
}

/* Add to cart button */
.btn-add-to-cart {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  font-weight: 500;
  background: #fff;
  color: #000;
  border: 2px solid #000; /* added black border */
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-add-to-cart:hover {
  border: 3px solid #000; 
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("product-form-{{ section.id }}");
  const quantityInput = document.getElementById("Quantity");
  const btnIncrease = document.getElementById("increase");
  const btnDecrease = document.getElementById("decrease");

  // Quantity buttons
  btnIncrease.addEventListener("click", () => {
    quantityInput.value = parseInt(quantityInput.value) + 1;
  });
  btnDecrease.addEventListener("click", () => {
    if (parseInt(quantityInput.value) > 1) {
      quantityInput.value = parseInt(quantityInput.value) - 1;
    }
  });

  // Add to cart submission
  const addonNomId = 51580032287050;
  const addonNumeroId = 51601975247178;
  const addonPlayerId = 51576525783370;

  form.addEventListener("submit", async function(e){
    e.preventDefault();
    const quantity = parseInt(quantityInput.value) || 1;
    const mainId = document.getElementById("main-product-id").value;
    const nom = document.getElementById("nom").value.trim();
    const numero = document.getElementById("numero").value.trim();
    const version = form.querySelector('input[name="version"]:checked')?.value;

    const productsToAdd = [{ id: mainId, quantity: quantity }];
    if(nom) productsToAdd.push({ id: addonNomId, quantity: quantity });
    if(numero) productsToAdd.push({ id: addonNumeroId, quantity: quantity });
    if(version === "Player") productsToAdd.push({ id: addonPlayerId, quantity: quantity });

    try {
      for(const prod of productsToAdd){
        await fetch("/cart/add.js", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(prod)
        }).then(res => res.json());
      }
      window.location.href = "/cart";
    } catch(err){
      alert("Erreur lors de l'ajout au panier : " + err.message);
      console.error(err);
    }
  });
});
</script>